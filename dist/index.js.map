{"version":3,"sources":["../webpack:/github-action-cleanup-releases-and-tags/lib/main.js","../webpack:/github-action-cleanup-releases-and-tags/webpack/bootstrap","../webpack:/github-action-cleanup-releases-and-tags/webpack/runtime/make namespace object","../webpack:/github-action-cleanup-releases-and-tags/webpack/runtime/compat","../webpack:/github-action-cleanup-releases-and-tags/webpack/startup"],"names":["__createBinding","undefined","Object","create","o","m","k","k2","defineProperty","enumerable","get","__setModuleDefault","v","value","__importStar","mod","__esModule","result","prototype","hasOwnProperty","call","__awaiter","thisArg","_arguments","P","generator","adopt","resolve","Promise","reject","fulfilled","step","next","e","rejected","done","then","apply","__importDefault","default","exports","core","require","github","rest_1","appVersionMaven_1","appVersionGradle_1","utils_1","tag_1","run","this","context","event","number","ref","payload","info","utils","github_token","getInput","required","branch","pr_number","filepath","default_version","tag_prefix","releases_only","sort_tags","bump","release_branch","octokit","Octokit","auth","userAgent","sortTagsDefault","sortTags","toLowerCase","baseBranch","br","stripRefs","bump_item","pr","repository","process","env","GITHUB_REPOSITORY","repos","repoSplit","setFailed","appVersion","normalize_version","app_version","prefix","searchPrefix","suffix","basename","getVersionStringPrefix","parseVersionString","latestGitTag","getLatestTag","owner","repo","tag_name","bumper","setOutput","error","message","fullTag","bumping","search_re","matcher","match","Error","groups","version","alpha","buildnumber","parseInt","includes","versionObj","major","minor","patch","str","vObj","x","split","tagPrefix","fromReleases","pages","endpoint","merge","per_page","tagHelper","tags","allNames","paginate","listReleases","response","data","map","item","listTags","name","tag","startsWith","push","length","sort","cmpTags","latestTag","slice","__webpack_module_cache__","__webpack_require__","moduleId","module","threw","__webpack_modules__","r","Symbol","toStringTag","ab","__dirname"],"mappings":"8DACA,IAAAA,EAAAC,WAAAA,UAAAD,kBAAAE,OAAAC,OAAA,SAAAC,EAAAC,EAAAC,EAAAC,GACA,GAAAA,IAAAN,UAAAM,EAAAD,EACAJ,OAAAM,eAAAJ,EAAAG,EAAA,CAAAE,WAAA,KAAAC,IAAA,WAAA,OAAAL,EAAAC,OACA,SAAAF,EAAAC,EAAAC,EAAAC,GACA,GAAAA,IAAAN,UAAAM,EAAAD,EACAF,EAAAG,GAAAF,EAAAC,KAEA,IAAAK,EAAAV,WAAAA,UAAAU,qBAAAT,OAAAC,OAAA,SAAAC,EAAAQ,GACAV,OAAAM,eAAAJ,EAAA,UAAA,CAAAK,WAAA,KAAAI,MAAAD,KACA,SAAAR,EAAAQ,GACAR,EAAA,WAAAQ,IAEA,IAAAE,EAAAb,WAAAA,UAAAa,cAAA,SAAAC,GACA,GAAAA,GAAAA,EAAAC,WAAA,OAAAD,EACA,IAAAE,EAAA,GACA,GAAAF,GAAA,KAAA,IAAA,IAAAT,KAAAS,EAAA,GAAAT,IAAA,WAAAJ,OAAAgB,UAAAC,eAAAC,KAAAL,EAAAT,GAAAN,EAAAiB,EAAAF,EAAAT,GACAK,EAAAM,EAAAF,GACA,OAAAE,GAEA,IAAAI,EAAApB,WAAAA,UAAAoB,WAAA,SAAAC,EAAAC,EAAAC,EAAAC,GACA,SAAAC,MAAAb,GAAA,OAAAA,aAAAW,EAAAX,EAAA,IAAAW,EAAA,SAAAG,GAAAA,EAAAd,KACA,OAAA,IAAAW,IAAAA,EAAAI,UAAA,SAAAD,EAAAE,GACA,SAAAC,UAAAjB,GAAA,IAAAkB,KAAAN,EAAAO,KAAAnB,IAAA,MAAAoB,GAAAJ,EAAAI,IACA,SAAAC,SAAArB,GAAA,IAAAkB,KAAAN,EAAA,SAAAZ,IAAA,MAAAoB,GAAAJ,EAAAI,IACA,SAAAF,KAAAd,GAAAA,EAAAkB,KAAAR,EAAAV,EAAAJ,OAAAa,MAAAT,EAAAJ,OAAAuB,KAAAN,UAAAI,UACAH,MAAAN,EAAAA,EAAAY,MAAAf,EAAAC,GAAA,KAAAS,WAGA,IAAAM,EAAArC,WAAAA,UAAAqC,iBAAA,SAAAvB,GACA,OAAAA,GAAAA,EAAAC,WAAAD,EAAA,CAAAwB,QAAAxB,IAEAb,OAAAM,eAAAgC,QAAA,aAAA,CAAA3B,MAAA,OACA,MAAA4B,EAAA3B,EAAA4B,QAAA,kBACA,MAAAC,EAAA7B,EAAA4B,QAAA,oBACA,MAAAE,EAAAF,QAAA,iBAEA,MAAAG,EAAAH,QAAA,qBACA,MAAAI,EAAAJ,QAAA,sBACA,MAAAK,EAAAT,EAAAI,QAAA,YACA,MAAAM,EAAAV,EAAAI,QAAA,UACA,SAAAO,MACA,OAAA5B,EAAA6B,UAAA,OAAA,EAAA,YACA,IACA,MAAAC,QAAAA,GAAAR,EACA,MAAAS,MAAAA,EAAAC,OAAAA,EAAAC,IAAAA,GAAAH,EAAAI,QACAd,EAAAe,uBAAAJ,KACA,MAAAK,EAAA,IAAAV,EAAAR,QACA,MAAAmB,EAAAjB,EAAAkB,SAAA,eAAA,CAAAC,SAAA,QACA,MAAAC,EAAApB,EAAAkB,SAAA,SAAA,CAAAC,SAAA,QACA,MAAAE,EAAArB,EAAAkB,SAAA,YAAA,CAAAC,SAAA,QACA,MAAAG,EAAAtB,EAAAkB,SAAA,WAAA,CAAAC,SAAA,OACA,MAAAI,EAAAvB,EAAAkB,SAAA,kBAAA,CAAAC,SAAA,QACA,MAAAK,EAAAxB,EAAAkB,SAAA,aAAA,CAAAC,SAAA,QACA,MAAAM,EAAAzB,EAAAkB,SAAA,gBAAA,CAAAC,SAAA,UAAA,OACA,MAAAO,EAAA1B,EAAAkB,SAAA,YAAA,CAAAC,SAAA,UAAA,OACA,MAAAQ,EAAA3B,EAAAkB,SAAA,OAAA,CAAAC,SAAA,QACA,MAAAS,EAAA5B,EAAAkB,SAAA,iBAAA,CAAAC,SAAA,OACA,MAAAU,EAAA,IAAA1B,EAAA2B,QAAA,CACAC,KAAAd,EACAe,UAAA,gEAGA,MAAAC,EAAAR,EAAA,QAAA,OACA,MAAAS,MAAAR,KAAAO,GAAAE,gBAAA,OACA,MAAAC,EAAAhB,GAAAP,EACA,MAAAwB,EAAArB,EAAAsB,UAAAF,GACA,MAAAG,EAAAF,IAAAT,EAAA,QAAAD,EACA,MAAAa,EAAAnB,GAAAT,EACA,MAAA6B,EAAAzC,EAAAkB,SAAA,aAAA,CAAAC,SAAA,SACAuB,QAAAC,IAAAC,kBACA,IAAAC,EAAA,KACA,IACAA,EAAA7B,EAAA8B,UAAAL,EAAA/B,GAEA,MAAAlB,GACAQ,EAAA+C,uCAAAvD,KAEA,IAAAqD,EAAA,CACA7C,EAAA+C,2EACA,OAEA,MAAAC,EAAAhC,EAAAiC,kBAAA7C,EAAA8C,YAAA5B,IAAAjB,EAAA6C,YAAA5B,GAAAC,GACA,MAAA4B,EAAA3B,GAAAwB,EACA,IAAAI,EACA,GAAAb,IAAA,QAAA,CACA,IAAAc,EAAA,QACA,GAAAb,EAAA,CACAa,OAAAb,SAEA,GAAAH,EAAA,CACAgB,EAAArC,EAAAsC,SAAAjB,GAEAe,KAAAD,KAAAE,QAEA,CACAD,EAAAG,uBAAAC,mBAAAL,GAAAZ,GAEA,MAAAkB,QAAAC,aAAAb,EAAAc,MAAAd,EAAAe,KAAAR,EAAA3B,EAAAS,EAAAL,GACA,MAAAgC,EAAAC,OAAAL,EAAAlB,GACAvC,EAAA+D,UAAA,WAAAF,GACA7D,EAAA+D,UAAA,cAAAf,GACAhD,EAAA+D,UAAA,gBAAAX,GACApD,EAAAe,kBAAA8C,KACA7D,EAAAe,qBAAAiC,KACAhD,EAAAe,uBAAAqC,KAEA,MAAAY,GACAhE,EAAA+C,UAAAiB,EAAAC,YAIAzD,MAEA,SAAAsD,OAAAI,EAAAC,GAEA,MAAAC,EAAA,0FACA,MAAAC,EAAAH,EAAAI,MAAAF,GACA,IAAAC,EAAA,CACA,MAAAE,wCAEA,CACA,MAAAC,EAAAH,EAAAG,OACA,IAAAA,EAAA,CACA,MAAAD,6CAAAL,SAEA,CACA,MAAAO,EAAAD,EAAAC,QACA,MAAAC,EAAAF,EAAAE,MACA,MAAAC,EAAAC,SAAAJ,EAAAG,aAAA,KACA,GAAAR,IAAA,QAAA,CACA,SAAAM,KAAAC,KAAAC,EAAA,SAEA,GAAA,CAAA,QAAA,QAAA,SAAAE,SAAAV,GAAA,CACA,MAAAW,EAAAtB,mBAAAiB,GACA,GAAAN,IAAA,QAAA,CACAW,EAAAC,OAAA,EACAD,EAAAE,MAAA,EACAF,EAAAG,MAAA,OAEA,GAAAd,IAAA,QAAA,CACAW,EAAAE,OAAA,EACAF,EAAAG,MAAA,OAEA,GAAAd,IAAA,QAAA,CACAW,EAAAG,OAAA,EAEA,SAAAH,EAAAC,SAAAD,EAAAE,SAAAF,EAAAG,YAEA,CACA,MAAAV,qEAAAJ,mBAKA,SAAAX,mBAAA0B,GACA,MAAAC,EAAA,CAAAJ,MAAA,EAAAC,MAAA,EAAAC,MAAA,GACA,MAAAG,EAAAF,EAAAG,MAAA,KAEAF,EAAAJ,MAAAH,SAAAQ,EAAA,KAAA,EACAD,EAAAH,MAAAJ,SAAAQ,EAAA,KAAA,EACAD,EAAAF,MAAAL,SAAAQ,EAAA,KAAA,EACA,OAAAD,EAEA,SAAA5B,uBAAAuB,EAAAX,GACA,GAAA,CAAA,QAAA,QAAA,SAAAU,SAAAV,GAAA,CACA,GAAAA,IAAA,QAAA,CACA,cAEA,GAAAA,IAAA,QAAA,CACA,SAAAW,EAAAC,aAEA,CACA,SAAAD,EAAAC,SAAAD,EAAAE,aAGA,CACA,SAAAF,EAAAC,SAAAD,EAAAE,SAAAF,EAAAG,SAGA,SAAAvB,aAAAC,EAAAC,EAAA0B,EAAAC,EAAArD,EAAAL,GACA,OAAAjD,EAAA6B,UAAA,OAAA,EAAA,YACA,MAAA+E,EAAA3D,EAAA4D,SAAAC,MAAA,CACA/B,MAAAA,EACAC,KAAAA,EACA+B,SAAA,MAEA,MAAAC,EAAA,IAAArF,EAAAT,QACA,MAAA+F,EAAA,GACA,IAAAC,EACA,GAAAP,EAAA,CACAO,QAAAjE,EAAAkE,SAAAlE,EAAAgB,MAAAmD,aAAAR,EAAAS,GAAAA,EAAAC,KAAAC,IAAAC,GAAAA,EAAAvC,eAEA,CACAiC,QAAAjE,EAAAkE,SAAAlE,EAAAgB,MAAAwD,SAAAb,EAAAS,GAAAA,EAAAC,KAAAC,IAAAC,GAAAA,EAAAE,OAEA,IAAA,MAAAC,KAAAT,EAAA,CACA,IAAAS,EAAAC,WAAAlB,GAAA,CACA,SAEA,IAAApD,EAAA,CAEA,OAAAqE,EAEAV,EAAAY,KAAAF,GAEA,GAAAV,EAAAa,SAAA,EAAA,CACA,OAAApB,EAGAO,EAAAc,KAAAf,EAAAgB,SACA,MAAAC,GAAAhB,EAAAiB,OAAA,GACA,OAAAD,OCnNA,IAAAE,EAAA,GAGA,SAAAC,oBAAAC,GAEA,GAAAF,EAAAE,GAAA,CACA,OAAAF,EAAAE,GAAAlH,QAGA,IAAAmH,EAAAH,EAAAE,GAAA,CAGAlH,QAAA,IAIA,IAAAoH,EAAA,KACA,IACAC,EAAAH,GAAAC,EAAAA,EAAAnH,QAAAiH,qBACAG,EAAA,MACA,QACA,GAAAA,SAAAJ,EAAAE,GAIA,OAAAC,EAAAnH,cCzBAiH,oBAAAK,EAAA,CAAAtH,IACA,UAAAuH,SAAA,aAAAA,OAAAC,YAAA,CACA9J,OAAAM,eAAAgC,EAAAuH,OAAAC,YAAA,CAAAnJ,MAAA,WAEAX,OAAAM,eAAAgC,EAAA,aAAA,CAAA3B,MAAA,aCJA4I,oBAAAQ,GAAAC,UAAA,ICEA,OAAAT,oBAAA","file":"index.js","sourcesContent":["\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst core = __importStar(require(\"@actions/core\"));\nconst github = __importStar(require(\"@actions/github\"));\nconst rest_1 = require(\"@octokit/rest\");\n// import {RequestInterface} from '@octokit/types'\nconst appVersionMaven_1 = require(\"./appVersionMaven\");\nconst appVersionGradle_1 = require(\"./appVersionGradle\");\nconst utils_1 = __importDefault(require(\"./utils\"));\nconst tag_1 = __importDefault(require(\"./tag\"));\nfunction run() {\n    return __awaiter(this, void 0, void 0, function* () {\n        try {\n            const { context } = github;\n            const { event, number, ref } = context.payload;\n            core.info(`Event type is: ${event}`);\n            const utils = new utils_1.default();\n            const github_token = core.getInput('github_token', { required: false });\n            const branch = core.getInput('branch', { required: false });\n            const pr_number = core.getInput('pr_number', { required: false });\n            const filepath = core.getInput('filepath', { required: true });\n            const default_version = core.getInput('default_version', { required: false });\n            const tag_prefix = core.getInput('tag_prefix', { required: false });\n            const releases_only = core.getInput('releases_only', { required: false }) === 'true';\n            const sort_tags = core.getInput('sort_tags', { required: false }) === 'true';\n            const bump = core.getInput('bump', { required: false });\n            const release_branch = core.getInput('release_branch', { required: true });\n            const octokit = new rest_1.Octokit({\n                auth: github_token,\n                userAgent: 'github-action-generate-tag-name-from-maven-or-gradle v1.0.0'\n            });\n            // It's somewhat safe to assume that the most recently created release is actually latest.\n            const sortTagsDefault = releases_only ? 'false' : 'true';\n            const sortTags = (`${sort_tags}` || sortTagsDefault).toLowerCase() === 'true';\n            const baseBranch = branch || ref;\n            const br = utils.stripRefs(baseBranch);\n            const bump_item = br !== release_branch ? 'build' : bump;\n            const pr = pr_number || number;\n            const repository = core.getInput('repository', { required: false }) ||\n                process.env.GITHUB_REPOSITORY;\n            let repos = null;\n            try {\n                repos = utils.repoSplit(repository, context);\n            }\n            catch (e) {\n                core.setFailed(`Action failed with error: ${e}`);\n            }\n            if (!repos) {\n                core.setFailed(`Action failed with error: No repository information available`);\n                return;\n            }\n            const appVersion = utils.normalize_version(appVersionMaven_1.app_version(filepath) || appVersionGradle_1.app_version(filepath), default_version);\n            const prefix = tag_prefix || appVersion;\n            let searchPrefix;\n            if (bump_item === 'build') {\n                let suffix = 'alpha';\n                if (pr) {\n                    suffix = `PR${pr}`;\n                }\n                else if (br) {\n                    suffix = utils.basename(br);\n                }\n                searchPrefix = `${prefix}-${suffix}`;\n            }\n            else {\n                searchPrefix = getVersionStringPrefix(parseVersionString(prefix), bump_item);\n            }\n            const latestGitTag = yield getLatestTag(repos.owner, repos.repo, searchPrefix, releases_only, sortTags, octokit);\n            const tag_name = bumper(latestGitTag, bump_item);\n            core.setOutput('tag_name', tag_name);\n            core.setOutput('app_version', appVersion);\n            core.setOutput('search_prefix', searchPrefix);\n            core.info(`Tag Name: ${tag_name}`);\n            core.info(`App Version: ${appVersion}`);\n            core.info(`Search Prefix: ${searchPrefix}`);\n        }\n        catch (error) {\n            core.setFailed(error.message);\n        }\n    });\n}\nrun();\n// Functions\nfunction bumper(fullTag, bumping) {\n    // v1.2.3-PR1234.3\n    const search_re = /^(v)?(?<version>[0-9]+\\.[0-9]+\\.[0-9])(_[0-9])?(?<alpha>-.*)?(?<buildnumber>\\.[0-9]+)?$/;\n    const matcher = fullTag.match(search_re);\n    if (!matcher) {\n        throw Error(`Version to bump is null???`);\n    }\n    else {\n        const groups = matcher.groups;\n        if (!groups) {\n            throw Error(`No versions found in current tag??? ${fullTag}`);\n        }\n        else {\n            const version = groups.version;\n            const alpha = groups.alpha;\n            const buildnumber = parseInt(groups.buildnumber || '0');\n            if (bumping === 'build') {\n                return `${version}-${alpha}.${buildnumber + 1}`;\n            }\n            else if (['major', 'minor', 'patch'].includes(bumping)) {\n                const versionObj = parseVersionString(version);\n                if (bumping === 'major') {\n                    versionObj.major += 1;\n                    versionObj.minor = 0;\n                    versionObj.patch = 0;\n                }\n                else if (bumping === 'minor') {\n                    versionObj.minor += 1;\n                    versionObj.patch = 0;\n                }\n                else if (bumping === 'patch') {\n                    versionObj.patch += 1;\n                }\n                return `${versionObj.major}.${versionObj.minor}.${versionObj.patch}`;\n            }\n            else {\n                throw Error(`Bump value must be one of: major, minor, or patch. Instead '${bumping}' was given`);\n            }\n        }\n    }\n}\nfunction parseVersionString(str) {\n    const vObj = { major: 0, minor: 0, patch: 0 };\n    const x = str.split('.');\n    // parse from string or default to 0 if can't parse\n    vObj.major = parseInt(x[0]) || 0;\n    vObj.minor = parseInt(x[1]) || 0;\n    vObj.patch = parseInt(x[2]) || 0;\n    return vObj;\n}\nfunction getVersionStringPrefix(versionObj, bumping) {\n    if (['major', 'minor', 'patch'].includes(bumping)) {\n        if (bumping === 'major') {\n            return ``;\n        }\n        else if (bumping === 'minor') {\n            return `${versionObj.major}.`;\n        }\n        else {\n            return `${versionObj.major}.${versionObj.minor}`;\n        }\n    }\n    else {\n        return `${versionObj.major}.${versionObj.minor}.${versionObj.patch}`;\n    }\n}\nfunction getLatestTag(owner, repo, tagPrefix, fromReleases, sortTags, octokit) {\n    return __awaiter(this, void 0, void 0, function* () {\n        const pages = octokit.endpoint.merge({\n            owner,\n            repo,\n            per_page: 100\n        });\n        const tagHelper = new tag_1.default();\n        const tags = [];\n        let allNames;\n        if (fromReleases) {\n            allNames = yield octokit.paginate(octokit.repos.listReleases, pages, response => response.data.map(item => item.tag_name));\n        }\n        else {\n            allNames = yield octokit.paginate(octokit.repos.listTags, pages, response => response.data.map(item => item.name));\n        }\n        for (const tag of allNames) {\n            if (!tag.startsWith(tagPrefix)) {\n                continue;\n            }\n            if (!sortTags) {\n                // Assume that the API returns the most recent tag(s) first.\n                return tag;\n            }\n            tags.push(tag);\n        }\n        if (tags.length === 0) {\n            return tagPrefix;\n        }\n        // eslint-disable-next-line @typescript-eslint/unbound-method\n        tags.sort(tagHelper.cmpTags);\n        const [latestTag] = tags.slice(-1);\n        return latestTag;\n    });\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tif(__webpack_module_cache__[moduleId]) {\n\t\treturn __webpack_module_cache__[moduleId].exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\tvar threw = true;\n\ttry {\n\t\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\t\tthrew = false;\n\t} finally {\n\t\tif(threw) delete __webpack_module_cache__[moduleId];\n\t}\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","\n__webpack_require__.ab = __dirname + \"/\";","// module exports must be returned from runtime so entry inlining is disabled\n// startup\n// Load entry module and return exports\nreturn __webpack_require__(109);\n"]}
module.exports=(()=>{"use strict";var e={109:(e,t,r)=>{r.r(t);var n=undefined&&undefined.__createBinding||(Object.create?function(e,t,r,n){if(n===undefined)n=r;Object.defineProperty(e,n,{enumerable:true,get:function(){return t[r]}})}:function(e,t,r,n){if(n===undefined)n=r;e[n]=t[r]});var a=undefined&&undefined.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var u=undefined&&undefined.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)if(r!=="default"&&Object.prototype.hasOwnProperty.call(e,r))n(t,e,r);a(t,e);return t};var o=undefined&&undefined.__awaiter||function(e,t,r,n){function adopt(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,a){function fulfilled(e){try{step(n.next(e))}catch(e){a(e)}}function rejected(e){try{step(n["throw"](e))}catch(e){a(e)}}function step(e){e.done?r(e.value):adopt(e.value).then(fulfilled,rejected)}step((n=n.apply(e,t||[])).next())})};var c=undefined&&undefined.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:true});const i=u(require("@actions/core"));const l=u(require("@actions/github"));const d=require("@octokit/rest");const f=require("./appVersionMaven");const p=require("./appVersionGradle");const s=c(require("./utils"));const _=c(require("./tag"));function run(){return o(this,void 0,void 0,function*(){try{const{context:e}=l;const{event:t,number:r,ref:n}=e.payload;i.info(`Event type is: ${t}`);const a=new s.default;const u=i.getInput("github_token",{required:false});const o=i.getInput("branch",{required:false});const c=i.getInput("pr_number",{required:false});const _=i.getInput("filepath",{required:true});const m=i.getInput("default_version",{required:false});const g=i.getInput("tag_prefix",{required:false});const h=i.getInput("releases_only",{required:false})==="true";const y=i.getInput("sort_tags",{required:false})==="true";const $=i.getInput("bump",{required:false});const q=i.getInput("release_branch",{required:true});const w=new d.Octokit({auth:u,userAgent:"github-action-generate-tag-name-from-maven-or-gradle v1.0.0"});const I=h?"false":"true";const S=(`${y}`||I).toLowerCase()==="true";const P=o||n;const V=a.stripRefs(P);const M=V!==q?"build":$;const T=c||r;const E=i.getInput("repository",{required:false})||process.env.GITHUB_REPOSITORY;let R=null;try{R=a.repoSplit(E,e)}catch(e){i.setFailed(`Action failed with error: ${e}`)}if(!R){i.setFailed(`Action failed with error: No repository information available`);return}const k=a.normalize_version(f.app_version(_)||p.app_version(_),m);const A=g||k;let B;if(M==="build"){let e="alpha";if(T){e=`PR${T}`}else if(V){e=a.basename(V)}B=`${A}-${e}`}else{B=getVersionStringPrefix(parseVersionString(A),M)}const F=yield getLatestTag(R.owner,R.repo,B,h,S,w);const L=bumper(F,M);i.setOutput("tag_name",L);i.setOutput("app_version",k);i.setOutput("search_prefix",B);i.info(`Tag Name: ${L}`);i.info(`App Version: ${k}`);i.info(`Search Prefix: ${B}`)}catch(e){i.setFailed(e.message)}})}run();function bumper(e,t){const r=/^(v)?(?<version>[0-9]+\.[0-9]+\.[0-9])(_[0-9])?(?<alpha>-.*)?(?<buildnumber>\.[0-9]+)?$/;const n=e.match(r);if(!n){throw Error(`Version to bump is null???`)}else{const r=n.groups;if(!r){throw Error(`No versions found in current tag??? ${e}`)}else{const e=r.version;const n=r.alpha;const a=parseInt(r.buildnumber||"0");if(t==="build"){return`${e}-${n}.${a+1}`}else if(["major","minor","patch"].includes(t)){const r=parseVersionString(e);if(t==="major"){r.major+=1;r.minor=0;r.patch=0}else if(t==="minor"){r.minor+=1;r.patch=0}else if(t==="patch"){r.patch+=1}return`${r.major}.${r.minor}.${r.patch}`}else{throw Error(`Bump value must be one of: major, minor, or patch. Instead '${t}' was given`)}}}}function parseVersionString(e){const t={major:0,minor:0,patch:0};const r=e.split(".");t.major=parseInt(r[0])||0;t.minor=parseInt(r[1])||0;t.patch=parseInt(r[2])||0;return t}function getVersionStringPrefix(e,t){if(["major","minor","patch"].includes(t)){if(t==="major"){return``}else if(t==="minor"){return`${e.major}.`}else{return`${e.major}.${e.minor}`}}else{return`${e.major}.${e.minor}.${e.patch}`}}function getLatestTag(e,t,r,n,a,u){return o(this,void 0,void 0,function*(){const o=u.endpoint.merge({owner:e,repo:t,per_page:100});const c=new _.default;const i=[];let l;if(n){l=yield u.paginate(u.repos.listReleases,o,e=>e.data.map(e=>e.tag_name))}else{l=yield u.paginate(u.repos.listTags,o,e=>e.data.map(e=>e.name))}for(const e of l){if(!e.startsWith(r)){continue}if(!a){return e}i.push(e)}if(i.length===0){return r}i.sort(c.cmpTags);const[d]=i.slice(-1);return d})}}};var t={};function __webpack_require__(r){if(t[r]){return t[r].exports}var n=t[r]={exports:{}};var a=true;try{e[r](n,n.exports,__webpack_require__);a=false}finally{if(a)delete t[r]}return n.exports}(()=>{__webpack_require__.r=(e=>{if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})})})();__webpack_require__.ab=__dirname+"/";return __webpack_require__(109)})();